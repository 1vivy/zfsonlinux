From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Brian Behlendorf <behlendorf1@llnl.gov>
Date: Fri, 22 Sep 2017 18:54:34 -0700
Subject: [PATCH] Update codecov.yml
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Update the codecov.yml to make the following functional changes.

* Do not require the CI testing to pass before posting results.
* Set red-yellow-green coverage percent from 50%-100%
* Allow a 1% drop in coverage to still be considered a pass.
* Reduce the size of the comment posted to the issue.

Additionally, the top level README.markdown has been updated
to include the codecov.io badge and the project summary reworded.

Reviewed-by: Prakash Surya <prakash.surya@delphix.com>
Signed-off-by: Brian Behlendorf <behlendorf1@llnl.gov>
Closes #6669
(cherry picked from commit 3790bfa80f9b26fd750b4a554c5707b9d380aac4)
Signed-off-by: Fabian Gr√ºnbichler <f.gruenbichler@proxmox.com>
---
 README.markdown     | 12 ++++++------
 .github/codecov.yml | 31 ++++++++++++++++++++++++++-----
 2 files changed, 32 insertions(+), 11 deletions(-)

diff --git a/README.markdown b/README.markdown
index fd2ca8c86..1c305b35d 100644
--- a/README.markdown
+++ b/README.markdown
@@ -1,9 +1,9 @@
-<p align="center"><img src="http://zfsonlinux.org/images/zfs-linux.png"/></p>
-ZFS is an advanced file system and volume manager which was originally
-developed for Solaris and is now maintained by the Illumos community.
+![img](http://zfsonlinux.org/images/zfs-linux.png)
 
-ZFS on Linux, which is also known as ZoL, is currently feature complete.  It
-includes fully functional and stable SPA, DMU, ZVOL, and ZPL layers. And it's native!
+ZFS on Linux is an advanced file system and volume manager which was originally
+developed for Solaris and is now maintained by the OpenZFS community.
+
+[![codecov](https://codecov.io/gh/zfsonlinux/zfs/branch/master/graph/badge.svg)](https://codecov.io/gh/zfsonlinux/zfs)
 
 # Official Resources
   * [Site](http://zfsonlinux.org)
@@ -16,4 +16,4 @@ Full documentation for installing ZoL on your favorite Linux distribution can
 be found at [our site](http://zfsonlinux.org/).
 
 # Contribute & Develop
-We have a separate document with [contribution guidelines](./.github/CONTRIBUTING.md).
\ No newline at end of file
+We have a separate document with [contribution guidelines](./.github/CONTRIBUTING.md).
diff --git a/.github/codecov.yml b/.github/codecov.yml
index f36be39cb..e74c59a0f 100644
--- a/.github/codecov.yml
+++ b/.github/codecov.yml
@@ -1,9 +1,30 @@
 codecov:
-  strict_yaml_branch: master # only use the latest copy on master branch
-
-comment: off
+  notify:
+    require_ci_to_pass: no
 
 coverage:
+  precision: 2
+  round: down
+  range: "50...100"
+
   status:
-    project: off
-    patch: off
+    project:
+      default:
+        threshold: 1%
+
+    patch:
+      default:
+        threshold: 1%
+
+parsers:
+  gcov:
+    branch_detection:
+      conditional: yes
+      loop: yes
+      method: no
+      macro: no
+
+comment:
+  layout: "header, sunburst, diff"
+  behavior: default
+  require_changes: no
-- 
2.14.2

