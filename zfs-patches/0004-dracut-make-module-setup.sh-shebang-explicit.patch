From 32939d5a4aed18160e508f029e5d26cf62e37ac6 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fabian=20Gr=C3=BCnbichler?= <f.gruenbichler@proxmox.com>
Date: Wed, 11 Oct 2017 14:28:07 +0200
Subject: [PATCH 04/11] dracut: make module-setup.sh shebang explicit
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Fabian Grünbichler <f.gruenbichler@proxmox.com>
---
 ...cut-make-module-setup.sh-shebang-explicit.patch | 42 ++++++++++++++++++++++
 debian/patches/series                              |  1 +
 2 files changed, 43 insertions(+)
 create mode 100644 debian/patches/0008-dracut-make-module-setup.sh-shebang-explicit.patch

diff --git a/debian/patches/0008-dracut-make-module-setup.sh-shebang-explicit.patch b/debian/patches/0008-dracut-make-module-setup.sh-shebang-explicit.patch
new file mode 100644
index 000000000..3114035dc
--- /dev/null
+++ b/debian/patches/0008-dracut-make-module-setup.sh-shebang-explicit.patch
@@ -0,0 +1,42 @@
+From: Fabian-Gruenbichler <f.gruenbichler@proxmox.com>
+Date: Mon, 14 Aug 2017 19:56:04 +0200
+Subject: dracut: make module-setup.sh shebang explicit
+MIME-Version: 1.0
+Content-Type: text/plain; charset="utf-8"
+Content-Transfer-Encoding: 8bit
+
+while these are source by dracut (which is a bash script)
+the practical difference is small, but it is more correct:
+
+/bin/sh is not bash on all systems (e.g. Debian and its
+derivatives use /bin/dash as /bin/sh by default).
+
+Reviewed-by: Brian Behlendorf <behlendorf1@llnl.gov>
+Signed-off-by: Fabian Grünbichler <f.gruenbichler@proxmox.com>
+Closes #6491
+(cherry picked from commit 42a76fc8d757ab82fc1ce8e5e1f2079e07a5b9d4)
+---
+ contrib/dracut/02zfsexpandknowledge/module-setup.sh.in | 2 +-
+ contrib/dracut/90zfs/module-setup.sh.in                | 2 +-
+ 2 files changed, 2 insertions(+), 2 deletions(-)
+
+diff --git a/contrib/dracut/02zfsexpandknowledge/module-setup.sh.in b/contrib/dracut/02zfsexpandknowledge/module-setup.sh.in
+index 981beb3..c22141f 100755
+--- a/contrib/dracut/02zfsexpandknowledge/module-setup.sh.in
++++ b/contrib/dracut/02zfsexpandknowledge/module-setup.sh.in
+@@ -1,4 +1,4 @@
+-#!/bin/sh
++#!/bin/bash
+ 
+ get_devtype() {
+   local typ
+diff --git a/contrib/dracut/90zfs/module-setup.sh.in b/contrib/dracut/90zfs/module-setup.sh.in
+index 9bbee0e..7632cbc 100755
+--- a/contrib/dracut/90zfs/module-setup.sh.in
++++ b/contrib/dracut/90zfs/module-setup.sh.in
+@@ -1,4 +1,4 @@
+-#!/bin/sh
++#!/bin/bash
+ 
+ check() {
+ 	# We depend on udev-rules being loaded
diff --git a/debian/patches/series b/debian/patches/series
index 5714ff20c..ca6cf6657 100644
--- a/debian/patches/series
+++ b/debian/patches/series
@@ -4,3 +4,4 @@
 enable-zed.patch
 1001-cmd-python-exec-path.patch
 1004-zed-service-bindir.patch
+0008-dracut-make-module-setup.sh-shebang-explicit.patch
-- 
2.14.1

